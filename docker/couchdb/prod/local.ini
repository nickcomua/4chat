[couchdb]
database_dir = /opt/couchdb/data
view_index_dir = /opt/couchdb/data
max_document_size = 4294967296 ; 4 GB
os_process_timeout = 5000
max_dbs_open = 500
delayed_commits = false
uuid = generate
users_db_security_editable = true

[cluster]
q=8
n=3

[chttpd]
port = 5984
bind_address = 0.0.0.0
; authentication_handlers = {cookie, default}, {proxy, default}
max_http_request_size = 4294967296 ; 4 GB
enable_cors = false
changes_timeout = 60000
max_db_number_for_dbs_info_req = 100

[httpd]
port = 5986
bind_address = 127.0.0.1
; authentication_handlers = {cookie, default}, {proxy, default}
secure_rewrites = true
allow_jsonp = false

[ssl]
port = 6984

; Production authentication settings - SECURE
[chttpd_auth]
authentication_db = _users
authentication_redirect = /_utils/session.html
require_valid_user = true
timeout = 300 ; 5 minutes
auth_cache_size = 50
allow_persistent_cookies = false
iterations = 10000 ; Strong hashing for production
min_iterations = 10000
max_iterations = 64000
password_scheme = pbkdf2
proxy_use_secret = true
secret = generate_random_secret_in_production

[couch_httpd_auth]
authentication_db = _users
authentication_redirect = /_utils/session.html
require_valid_user = true
timeout = 300
auth_cache_size = 50
allow_persistent_cookies = false
iterations = 10000 ; Strong hashing for production
min_iterations = 10000
max_iterations = 64000
password_scheme = pbkdf2

; CORS settings for production - restrictive
[cors]
origins = https://yourdomain.com,https://www.yourdomain.com
credentials = true
methods = GET, PUT, POST, HEAD, DELETE
headers = accept, authorization, content-type, origin, referer

; Minimal logging for production
[log]
level = warning
include_sasl = false

[couch_log]
level = warning
max_buffer_size = 100

; Query server settings
[query_servers]
javascript = /opt/couchdb/bin/couchjs /opt/couchdb/share/server/main.js
coffeescript = /opt/couchdb/bin/couchjs /opt/couchdb/share/server/main-coffee.js

[query_server_config]
reduce_limit = true
os_process_limit = 25

; Replicator settings for production
[replicator]
max_replication_retry_count = 10
worker_processes = 4
worker_batch_size = 500
http_connections = 20
connection_timeout = 30000
retries_per_request = 5
socket_options = [{keepalive, true}, {nodelay, false}]

; Compaction settings
[compactions]
_default = [{db_fragmentation, "70%"}, {view_fragmentation, "60%"}, {from, "02:00"}, {to, "06:00"}]

; Production settings
[couchdb_engines]
couch = couch_bt_engine

[smoosh]
db_channels = upgrade_dbs,ratio_dbs,slack_dbs
view_channels = upgrade_views,ratio_views,slack_views

[smoosh.ratio_dbs]
priority = ratio
min_priority = 2.0

[smoosh.ratio_views]
priority = ratio
min_priority = 2.0

[smoosh.slack_dbs]
priority = slack
min_priority = 536870912

[smoosh.slack_views]
priority = slack
min_priority = 536870912

[smoosh.upgrade_dbs]
priority = upgrade

[smoosh.upgrade_views]
priority = upgrade

; Security settings
[admins]
; Add admin users here or use environment variables

[couch_peruser]
enable = true
delete_dbs = true

; Additional security headers
[chttpd_auth]
x_forwarded_host = X-Forwarded-Host
x_forwarded_proto = X-Forwarded-Proto
x_forwarded_ssl = X-Forwarded-Ssl 